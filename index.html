<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TripMate – Travel Organizer (SIH Demo)</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #000000;
      --card: #ff7700;
      --muted: #560505;
      --ring: #000000;
    }
    body { background: linear-gradient(180deg, #dfe1e3 0%, #fefeff 100%); color: #ffffff; }
    .navbar, .offcanvas, .modal-content { background-color: var(--card); }
    .card { background-color: var(--card); border: 1px solid var(--ring); }
    .form-control, .form-select { background-color: #ffffff; border-color: #52732e; color: #000000; }
    .form-control::placeholder { color: #8aa0c6; }
    .btn-primary { background: #3b82f6; border-color: #3b82f6; }
    .btn-outline-light { border-color: #f10606; }
    .nav-pills .nav-link.active { background: #2563eb; }
    .badge { font-weight: 500; }
    .shadow-soft { box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .pointer { cursor: pointer; }
    .truncate-1 { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .truncate-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    a { color: #000000; }
    a:hover { color: #b9d4ff; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark border-bottom border-secondary sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#" onclick="navigateHome()">
        <i class="bi bi-compass me-2"></i>TripMate
      </a>
      <div class="d-flex gap-2 ms-auto">
        <button class="btn btn-outline-light btn-sm" onclick="seedDemoData()"><i class="bi bi-magic me-1"></i> Demo Data</button>
        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#newTripModal"><i class="bi bi-plus-lg me-1"></i>New Trip</button>
      </div>
    </div>
  </nav>

  <!-- Main Container -->
  <main class="container my-4">
    <!-- Home View -->
    <section id="homeView">
      <div class="row g-4 align-items-stretch" >
        <div class="col-12 col-lg-12" >
          <div class="card shadow-soft h-100">
            <div class="card-body text-light" >
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-suitcase2-fill fs-3 me-2 text-primary"></i>
                <h2 class="h4 text-light mb-0">Your Trips</h2>
              </div>
              <div class="row" id="tripList"></div>
              <div id="emptyState" class="text-center text-light p-5">
                <i class="bi bi-geo-alt fs-1 text-primary"></i>
                <p class="mt-3 mb-1">No trips yet.</p>
                <p class="text-muted">Create your first trip to plan itinerary, track expenses, store tickets & more.</p>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newTripModal"><i class="bi bi-plus-lg me-1"></i>Create Trip</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Trip Detail View -->
    <section id="tripView" class="d-none">
      <div class="mb-3">
        <button class="btn btn-outline-dark btn-sm" onclick="navigateHome()"><i class="bi bi-arrow-left"></i> Back</button>
      </div>
      <div id="tripHeader" class="card shadow-soft mb-3">
        <div class="card-body d-flex flex-wrap gap-3 align-items-center justify-content-between">
          <div>
            <h2 id="tripTitle" class="h4 mb-1">Trip Title</h2>
            <div id="tripMeta" class="small text-muted">Destination • Dates</div>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-light" onclick="shareTrip()"><i class="bi bi-share"></i> Share</button>
            <button class="btn btn-danger" onclick="deleteTrip()"><i class="bi bi-trash3"></i> Delete</button>
          </div>
        </div>
      </div>

      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pills-itinerary-tab" data-bs-toggle="pill" data-bs-target="#pills-itinerary" type="button" role="tab">Itinerary</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="pills-expense-tab" data-bs-toggle="pill" data-bs-target="#pills-expense" type="button" role="tab">Expenses</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="pills-docs-tab" data-bs-toggle="pill" data-bs-target="#pills-docs" type="button" role="tab">Documents</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="pills-notes-tab" data-bs-toggle="pill" data-bs-target="#pills-notes" type="button" role="tab">Notes / Photos</button>
        </li>
      </ul>
      <div class="tab-content" id="pills-tabContent">
        <!-- ITINERARY TAB -->
        <div class="tab-pane fade show active" id="pills-itinerary" role="tabpanel">
          <div class="card mb-3">
            <div class="card-body">
              <form id="itineraryForm" class="row g-2 align-items-end">
                <div class="col-12 col-md-2">
                  <label class="form-label">Date</label>
                  <input type="date" class="form-control" id="itDate" />
                </div>
                <div class="col-12 col-md-2">
                  <label class="form-label">Time</label>
                  <input type="time" class="form-control" id="itTime" />
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Title</label>
                  <input type="text" class="form-control" id="itTitle" placeholder="Beach, Museum..." />
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Location</label>
                  <input type="text" class="form-control" id="itLocation" placeholder="Baga Beach" />
                </div>
                <div class="col-12 col-md-2">
                  <label class="form-label">Maps Link</label>
                  <input type="url" class="form-control" id="itMap" placeholder="https://maps..." />
                </div>
                <div class="col-12 mt-2">
                  <button class="btn btn-primary" type="submit"><i class="bi bi-plus-lg me-1"></i>Add Activity</button>
                </div>
              </form>
            </div>
          </div>
          <div id="itineraryList" class="row g-3"></div>
        </div>

        <!-- EXPENSE TAB -->
        <div class="tab-pane fade" id="pills-expense" role="tabpanel">
          <div class="card mb-3">
            <div class="card-body">
              <form id="expenseForm" class="row g-2 align-items-end">
                <div class="col-12 col-md-2">
                  <label class="form-label">Date</label>
                  <input type="date" class="form-control" id="exDate" />
                </div>
                <div class="col-12 col-md-2">
                  <label class="form-label">Category</label>
                  <select class="form-select" id="exCategory">
                    <option>Food</option>
                    <option>Transport</option>
                    <option>Stay</option>
                    <option>Shopping</option>
                    <option>Activities</option>
                    <option>Other</option>
                  </select>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Description</label>
                  <input type="text" class="form-control" id="exDesc" placeholder="Lunch at beach shack" />
                </div>
                <div class="col-12 col-md-2">
                  <label class="form-label">Amount (₹)</label>
                  <input type="number" class="form-control" id="exAmount" min="0" step="0.01" />
                </div>
                <div class="col-12 col-md-2">
                  <button class="btn btn-primary w-100" type="submit"><i class="bi bi-plus-lg me-1"></i>Add</button>
                </div>
              </form>
            </div>
          </div>
          <div class="row g-3">
            <div class="col-12 col-lg-8">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Expenses</h5>
                    <span class="badge text-bg-secondary" id="expenseCount">0 items</span>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-dark table-sm align-middle mb-0">
                      <thead>
                        <tr><th>Date</th><th>Category</th><th>Description</th><th class="text-end">Amount (₹)</th><th></th></tr>
                      </thead>
                      <tbody id="expenseTable"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-4">
              <div class="card h-100">
                <div class="card-body">
                  <h5>Summary</h5>
                  <div id="expenseSummary" class="small text-muted"></div>
                  <hr />
                  <div class="d-flex justify-content-between">
                    <div class="fw-semibold">Total</div>
                    <div class="fw-bold" id="expenseTotal">₹0</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- DOCUMENTS TAB -->
        <div class="tab-pane text-light fade" id="pills-docs" role="tabpanel">
          <div class="card mb-3">
            <div class="card-body">
              <form id="docForm" class="row g-2 align-items-end">
                <div class="col-12 col-md-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" id="docName" placeholder="Flight Ticket" />
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Type</label>
                  <select class="form-select" id="docType">
                    <option>Ticket</option>
                    <option>Hotel</option>
                    <option>ID</option>
                    <option>Pass</option>
                    <option>Other</option>
                  </select>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label">Link (Drive/URL)</label>
                  <input type="url" class="form-control" id="docUrl" placeholder="https://drive..." />
                </div>
                <div class="col-12 col-md-2">
                  <button class="btn btn-primary w-100" type="submit"><i class="bi bi-plus-lg me-1"></i>Add</button>
                </div>
                <div class="col-12">
                  <div class="form-text text-muted">For demo, we store links/notes. (LocalStorage is used; no files are uploaded.)</div>
                </div>
              </form>
            </div>
          </div>
          <div id="docList" class="row g-3"></div>
        </div>

        <!-- NOTES TAB -->
        <div class="tab-pane fade" id="pills-notes" role="tabpanel">
          <div class="card mb-3">
            <div class="card-body">
              <form id="noteForm" class="row g-2 align-items-end">
                <div class="col-12 col-md-8">
                  <label class="form-label">Note</label>
                  <input type="text" class="form-control" id="noteText" placeholder="Quick memory or reminder" />
                </div>
                <div class="col-12 col-md-3">
                  <label class="form-label">Image URL (optional)</label>
                  <input type="url" class="form-control" id="noteImg" placeholder="https://..." />
                </div>
                <div class="col-12 col-md-1">
                  <button class="btn btn-primary w-100" type="submit"><i class="bi bi-plus-lg"></i></button>
                </div>
              </form>
            </div>
          </div>
          <div id="noteList" class="row g-3"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- New Trip Modal -->
  <div class="modal fade " id="newTripModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-plus-lg me-2"></i>Create New Trip</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="tripForm" class="row g-3">
            <div class="col-12">
              <label class="form-label">Trip Name</label>
              <input type="text" class="form-control" id="tripName" placeholder="Goa Getaway" required />
            </div>
            <div class="col-12">
              <label class="form-label">Destination</label>
              <input type="text" class="form-control" id="tripDestination" placeholder="Goa, India" required />
            </div>
            <div class="col-6">
              <label class="form-label">Start Date</label>
              <input type="date" class="form-control" id="tripStart" required />
            </div>
            <div class="col-6">
              <label class="form-label">End Date</label>
              <input type="date" class="form-control" id="tripEnd" required />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" onclick="createTrip()">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
    <div id="liveToast" class="toast text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-body"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // -----------------------
    // Storage Helpers
    // -----------------------
    const KEY = 'tripmate_trips_v1';
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const read = () => JSON.parse(localStorage.getItem(KEY) || '[]');
    const write = (data) => localStorage.setItem(KEY, JSON.stringify(data));

    // State
    let trips = read();
    let currentId = null;

    // Utils
    const uid = () => Math.random().toString(36).slice(2, 10);
    const fmt = (d) => d ? new Date(d).toLocaleDateString() : '';
    const money = (n) => `₹${(Number(n)||0).toLocaleString(undefined,{maximumFractionDigits:2})}`;

    const toast = (msg) => {
      const t = $('#liveToast');
      t.querySelector('.toast-body').textContent = msg;
      bootstrap.Toast.getOrCreateInstance(t, {delay: 1600}).show();
    };

    // -----------------------
    // Home Rendering
    // -----------------------
    function renderHome(){
      const list = $('#tripList');
      const empty = $('#emptyState');
      list.innerHTML = '';

      if(!trips.length){ empty.classList.remove('d-none'); return; }
      empty.classList.add('d-none');

      trips.forEach(t => {
        const days = t.startDate && t.endDate ? Math.max(1, Math.round((new Date(t.endDate)-new Date(t.startDate))/(1000*60*60*24))+1) : '-';
        const card = document.createElement('div');
        card.className = 'col-12 col-md-6 col-xl-4';
        card.innerHTML = `
          <div class="card h-100 pointer" onclick="openTrip('${t.id}')">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <h5 class="truncate-1">${t.name}</h5>
                  <div class="small text-muted truncate-1"><i class="bi bi-geo-alt me-1"></i>${t.destination}</div>
                  <div class="small text-muted"><i class="bi bi-calendar3 me-1"></i>${fmt(t.startDate)} - ${fmt(t.endDate)} • ${days} day(s)</div>
                </div>
                <span class="badge text-bg-primary">${(t.itinerary?.length||0)} plans</span>
              </div>
              <hr />
              <div class="d-flex justify-content-between small text-muted">
                <div><i class="bi bi-receipt me-1"></i>${(t.expenses?.length||0)} expenses</div>
                <div><i class="bi bi-file-earmark-text me-1"></i>${(t.documents?.length||0)} docs</div>
                <div><i class="bi bi-card-image me-1"></i>${(t.notes?.length||0)} notes</div>
              </div>
            </div>
          </div>`;
        list.appendChild(card);
      });
    }

    // Navigation
    function navigateHome(){
      $('#tripView').classList.add('d-none');
      $('#homeView').classList.remove('d-none');
      renderHome();
    }

    function openTrip(id){
      currentId = id;
      const t = trips.find(x=>x.id===id);
      if(!t) return;
      $('#homeView').classList.add('d-none');
      $('#tripView').classList.remove('d-none');
      $('#tripTitle').textContent = t.name;
      $('#tripMeta').textContent = `${t.destination} • ${fmt(t.startDate)} - ${fmt(t.endDate)}`;
      renderItinerary();
      renderExpenses();
      renderDocs();
      renderNotes();
    }

    // Create Trip
    function createTrip(){
      const name = $('#tripName').value.trim();
      const destination = $('#tripDestination').value.trim();
      const startDate = $('#tripStart').value;
      const endDate = $('#tripEnd').value;
      if(!name || !destination || !startDate || !endDate){ toast('Please fill all fields'); return; }
      const t = { id: uid(), name, destination, startDate, endDate, itinerary: [], expenses: [], documents: [], notes: [] };
      trips.push(t); write(trips);
      const modalEl = $('#newTripModal');
      const bsModal = bootstrap.Modal.getInstance(modalEl);
      if(bsModal) bsModal.hide();
      $('#tripForm').reset();
      toast('Trip created');
      renderHome();
    }

    // Delete Trip
    function deleteTrip(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      if(!confirm(`Delete trip "${t.name}"?`)) return;
      trips = trips.filter(x=>x.id!==currentId); write(trips);
      currentId = null; toast('Trip deleted'); navigateHome();
    }

    // -----------------------
    // Itinerary
    // -----------------------
    $('#itineraryForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const date=$('#itDate').value, time=$('#itTime').value, title=$('#itTitle').value.trim(), loc=$('#itLocation').value.trim(), map=$('#itMap').value.trim();
      if(!title){ toast('Add a title'); return; }
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.itinerary.push({ id: uid(), date, time, title, location: loc, mapUrl: map });
      write(trips); e.target.reset(); toast('Activity added'); renderItinerary();
    });

    function renderItinerary(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      const wrap = $('#itineraryList'); wrap.innerHTML='';
      const items = [...(t.itinerary||[])].sort((a,b)=> (a.date+a.time).localeCompare(b.date+b.time));
      if(!items.length){ wrap.innerHTML = "<div class='text-muted text-center p-4'>No items yet.</div>"; return; }
      items.forEach(it=>{
        const col = document.createElement('div');
        col.className='col-12 col-md-6';
        col.innerHTML = `
          <div class='card h-100'>
            <div class='card-body'>
              <div class='d-flex justify-content-between'>
                <div>
                  <div class='small text-muted'>${fmt(it.date)} ${it.time||''}</div>
                  <h6 class='mb-1'>${it.title}</h6>
                  <div class='small text-muted'><i class='bi bi-geo me-1'></i>${it.location||'-'}</div>
                  ${it.mapUrl ? `<a href='${it.mapUrl}' target='_blank' class='small'>Open in Maps <i class="bi bi-box-arrow-up-right"></i></a>` : ''}
                </div>
                <button class='btn btn-sm btn-outline-light' onclick="removeItinerary('${it.id}')"><i class='bi bi-trash'></i></button>
              </div>
            </div>
          </div>`;
        wrap.appendChild(col);
      });
    }
    function removeItinerary(id){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.itinerary = t.itinerary.filter(x=>x.id!==id); write(trips); toast('Removed'); renderItinerary();
    }

    // -----------------------
    // Expenses
    // -----------------------
    $('#expenseForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const date=$('#exDate').value, cat=$('#exCategory').value, desc=$('#exDesc').value.trim(), amt=Number($('#exAmount').value);
      if(!desc || !amt){ toast('Enter description and amount'); return; }
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.expenses.push({ id: uid(), date, category: cat, description: desc, amount: Number(amt) });
      write(trips); e.target.reset(); toast('Expense added'); renderExpenses();
    });

    function renderExpenses(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      const tbody = $('#expenseTable'); tbody.innerHTML='';
      const items = [...(t.expenses||[])].sort((a,b)=> (a.date||'').localeCompare(b.date||''));
      let total = 0; const byCat = {};
      items.forEach(ex=>{
        total += ex.amount; byCat[ex.category] = (byCat[ex.category]||0) + ex.amount;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${ex.date||'-'}</td>
          <td>${ex.category}</td>
          <td>${ex.description}</td>
          <td class='text-end'>${money(ex.amount)}</td>
          <td class='text-end'><button class='btn btn-sm btn-outline-light' onclick="removeExpense('${ex.id}')"><i class='bi bi-trash'></i></button></td>`;
        tbody.appendChild(tr);
      });
      $('#expenseCount').textContent = `${items.length} item(s)`;
      $('#expenseTotal').textContent = money(total);
      const summary = Object.entries(byCat).map(([k,v])=>`<div class='d-flex justify-content-between'><span>${k}</span><span>${money(v)}</span></div>`).join('');
      $('#expenseSummary').innerHTML = summary || '<span class="text-muted">No expenses yet.</span>';
    }
    function removeExpense(id){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.expenses = t.expenses.filter(x=>x.id!==id); write(trips); toast('Removed'); renderExpenses();
    }

    // -----------------------
    // Documents
    // -----------------------
    $('#docForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const name=$('#docName').value.trim(), type=$('#docType').value, url=$('#docUrl').value.trim();
      if(!name){ toast('Add a document name'); return; }
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.documents.push({ id: uid(), name, type, url }); write(trips); e.target.reset(); toast('Document saved'); renderDocs();
    });
    function renderDocs(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      const wrap = $('#docList'); wrap.innerHTML='';
      const items = t.documents||[];
      if(!items.length){ wrap.innerHTML = "<div class='text-muted text-center p-4'>No documents yet.</div>"; return; }
      items.forEach(d=>{
        const col = document.createElement('div'); col.className='col-12 col-md-6 col-xl-4';
        col.innerHTML = `
          <div class='card h-100'>
            <div class='card-body d-flex justify-content-between align-items-start'>
              <div>
                <div class='small text-muted'>${d.type}</div>
                <h6 class='mb-1 truncate-2'>${d.name}</h6>
                ${d.url ? `<a href='${d.url}' target='_blank' class='small'>Open Link <i class="bi bi-box-arrow-up-right"></i></a>` : `<span class='small text-muted'>No link</span>`}
              </div>
              <button class='btn btn-sm btn-outline-light' onclick="removeDoc('${d.id}')"><i class='bi bi-trash'></i></button>
            </div>
          </div>`;
        wrap.appendChild(col);
      });
    }
    function removeDoc(id){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.documents = t.documents.filter(x=>x.id!==id); write(trips); toast('Removed'); renderDocs();
    }

    // -----------------------
    // Notes
    // -----------------------
    $('#noteForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const text=$('#noteText').value.trim(), img=$('#noteImg').value.trim();
      if(!text){ toast('Write a note'); return; }
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.notes.push({ id: uid(), date: new Date().toISOString(), text, imageUrl: img }); write(trips); e.target.reset(); toast('Note added'); renderNotes();
    });
    function renderNotes(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      const wrap = $('#noteList'); wrap.innerHTML='';
      const items = [...(t.notes||[])].sort((a,b)=> (b.date||'').localeCompare(a.date||''));
      if(!items.length){ wrap.innerHTML = "<div class='text-muted text-center p-4'>No notes yet.</div>"; return; }
      items.forEach(n=>{
        const col = document.createElement('div'); col.className='col-12 col-md-6 col-xl-4';
        col.innerHTML = `
          <div class='card h-100'>
            ${n.imageUrl ? `<img src='${n.imageUrl}' class='card-img-top' alt='note image' onerror="this.style.display='none'">` : ''}
            <div class='card-body d-flex justify-content-between align-items-start'>
              <div>
                <div class='small text-muted mb-1'>${new Date(n.date).toLocaleString()}</div>
                <div>${n.text}</div>
              </div>
              <button class='btn btn-sm btn-outline-light' onclick="removeNote('${n.id}')"><i class='bi bi-trash'></i></button>
            </div>
          </div>`;
        wrap.appendChild(col);
      });
    }
    function removeNote(id){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      t.notes = t.notes.filter(x=>x.id!==id); write(trips); toast('Removed'); renderNotes();
    }

    // -----------------------
    // Share, Export, Print
    // -----------------------
    function shareTrip(){
      const t = trips.find(x=>x.id===currentId); if(!t) return;
      const total = (t.expenses||[]).reduce((a,b)=>a+(b.amount||0),0);
      const summary = `Trip: ${t.name}\nDestination: ${t.destination}\nDates: ${fmt(t.startDate)} - ${fmt(t.endDate)}\nItinerary items: ${t.itinerary?.length||0}\nExpenses total: ${money(total)}`;
      navigator.clipboard?.writeText(summary);
      toast('Summary copied to clipboard');
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(trips, null, 2)], {type: 'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'tripmate-data.json';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function printSummary(){
      window.print();
    }

    // -----------------------
    // Demo Seed
    // -----------------------
    function seedDemoData(){
      if(trips.length && !confirm('Replace current data with demo content?')) return;
      trips = [
        {
          id: uid(),
          name: 'Goa Getaway',
          destination: 'Goa, India',
          startDate: new Date().toISOString().slice(0,10),
          endDate: new Date(Date.now()+4*86400000).toISOString().slice(0,10),
          itinerary: [
            { id: uid(), date: new Date().toISOString().slice(0,10), time: '10:00', title: 'Baga Beach', location: 'Baga', mapUrl: 'https://maps.google.com' },
            { id: uid(), date: new Date(Date.now()+86400000).toISOString().slice(0,10), time: '15:00', title: 'Water Sports', location: 'Calangute', mapUrl: '' }
          ],
          expenses: [
            { id: uid(), date: new Date().toISOString().slice(0,10), category: 'Transport', description: 'Cab from airport', amount: 1200 },
            { id: uid(), date: new Date().toISOString().slice(0,10), category: 'Food', description: 'Lunch', amount: 450 }
          ],
          documents: [
            { id: uid(), name: 'IndiGo Flight 6E-512', type: 'Ticket', url: 'https://example.com/ticket' },
            { id: uid(), name: 'OYO Beach Stay', type: 'Hotel', url: '' }
          ],
          notes: [
            { id: uid(), date: new Date().toISOString(), text: 'Sunset boat ride plan', imageUrl: '' }
          ]
        }
      ];
      write(trips); toast('Demo data added'); renderHome();
    }

    // Init
    renderHome();
  </script>
</body>
</html>
